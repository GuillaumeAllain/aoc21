input←⊃⎕NGET'../data/day13'1
fm←(∨/'fold'∊⊢)¨
fa←(⊢+(0≠⊢))(((⊃⊢)⌽((2=⍳2)×⊢))¨((('x'=⊃),(⍎(⊃(¯1↑⊢))))¨(('fold along '⎕R'')¨¨((('='(≠⊆⊢)⊢))¨((⊢(/⍨)fm)⊢)))))
co←(1+⊢)((⍎)¨¨(((','(≠⊆⊢)⊢))¨(¯1↓((⊢(/⍨)(~fm))⊢))))

fn←((⊃(⍴fa))input)
fc←∪⍥|{⍺⌷fa input}∘.-⊢
fcp←{(1+1⌷⍵),(⊃fc(1↓⊢))⍵}
ft←fcp⍣fn

⍴1↓fcp 1,(co input)
⌽[2]⌽[1]⍉((⍳((↑⌈⌿)))∊⊢)(1↓(ft(1,(co⊢))))input
